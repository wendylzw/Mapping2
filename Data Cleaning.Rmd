---
title: "Data Cleaning"
author: "Group"
date: "11/10/2020"
output: pdf_document
---

```{r setup, include=FALSE,message=FALSE,warning=FALSE,fig.align='center'}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(maps)
library(ggplot2)
library(dplyr)
library(lubridate)
library(rgdal)
library(usmap)
library(leaflet)
```

### Brief Description
The Public Assistance Funded Projects Details dataset contains obligated (financial obligation to grantee) Public Assistance projects, lists public assistance recipients designated as applicants in the data, and a list of every funded, individual project, called project worksheets. Open projects still under pre-obligation processing are not represented.

The dataset is from <https://www.fema.gov/openfema-data-page/public-assistance-funded-projects-details-v1>


### Data Orgnazition
In this project, we will focus on the hurricane,coastal storm during 2009-2018.

The following are the variables we need:  

- `disasterNumber`: Sequentially assigned number used to designate an event or incident declared as a disaster.

- `declarationDate`: Date the disaster was declared.

- `incidentType`: Type of incident

- `projectAmount`: The estimated total cost of the Public Assistance grant project in dollars, without administrative costs.

- `totalObligated`: The federal share of the Public Assistance grant eligible project amount in dollars, plus grantee (State) and sub-grantee (applicant) administrative costs.

- `obligatedDate`: Date the grant was obligated.

- `dcc`: Damage category code. Category A: Debris removal; Category B: Emergency protective measures; Category C: Roads and bridges; Category D: Water control facilities; Category E: Public buildings and contents; Category F: Public utilities; Category G: Parks, recreational, and other facilities

- `projectSize`: Projects are designated as Large or Small.

```{r}
data <- read.csv('PublicAssistanceFundedProjectsDetails.csv')

#choose disaster type
df <- data%>%filter(incidentType %in% c("Hurricane","Coastal Storm"))
df <-na.omit(df)

#choose time
df$declarationDate <-  as_datetime(df$declarationDate)
df$declarationYear <-  year(df$declarationDate)
df$obligatedDate <- as_datetime(df$obligatedDate)
df$obligatedYear <- year(df$declarationDate)

#sum(ifelse(df$declarationYear==df$obligatedYear,0,1))==0
df <- df %>% filter(declarationYear > 2009 & declarationYear < 2018)

#choose variables
df <- df %>% select(-c("pwNumber","applicationTitle","applicantId","damageCategoryCode","damageCategory","hash","lastRefresh","id"))

#write.csv(df,"hur_stm.csv",row.names=FALSE)
```



### Create Fips
```{r}
df= read.csv("hur_stm.csv")
df$fips=NA
for (i in 1:dim(df)[1]){
  if(df$countyCode[i]> 99){
  df$fips[i] <- str_c(as.character(df$stateNumberCode[i]),as.character(df$countyCode[i]))}
  else if(df$countyCode[i]>=10){
   df$fips[i] <- str_c(as.character(df$stateNumberCode[i]),"0",as.character(df$countyCode[i]))
  }
  else if(df$countyCode[i]<10){
   df$fips[i] <- str_c(as.character(df$stateNumberCode[i]),"0","0",as.character(df$countyCode[i]))
  }
}
#df$fips


#unique(df$stateNumberCode)
#there are 0 value for statewide disasters 
#unique(df$countyCode)

#divide dataset by county = statewide 
df_statewide = df %>% filter(countyCode == 0)
#nrow(df_statewide)=10839
df_countywide = df %>% filter(countyCode != 0)
#nrow(df_countywide)=62726
```









